{% load humanize %}
{% for product in products %}
<div class="bg-white p-3 rounded-lg shadow-sm border border-brand-200 hover:border-brand-500 transition relative group"
    x-data="{ qty: 1 }">

    <div class="flex justify-between items-start">
        <div class="truncate pr-2 cursor-pointer flex-1" hx-post="{% url 'add_to_cart' %}"
            hx-vals='{"product_id": "{{ product.id }}", "quantity": 1 }' hx-target="#cart-items, #cart-items-desktop">
            <div class="text-sm font-bold text-brand-500 truncate">{{ product.name }}</div>
            <div class="text-xs text-gray-400">{{ product.barcode }}</div>
        </div>

        <!-- Manual Quantity Input Form -->
        <form hx-post="{% url 'add_to_cart' %}" hx-target="#cart-items, #cart-items-desktop"
            class="flex flex-col items-end z-10" onclick="event.stopPropagation()">
            <input type="hidden" name="product_id" value="{{ product.id }}">
            <input type="number" min="1" value="1" name="quantity"
                class="w-12 text-center text-xs border border-brand-200 rounded p-1 mb-1">
            <button type="submit" class="bg-brand-500 text-white text-xs px-2 py-1 rounded hover:bg-brand-400">
                + Add
            </button>
        </form>
    </div>

    <div class="flex justify-between items-end mt-2 cursor-pointer" hx-post="{% url 'add_to_cart' %}"
        hx-vals='{"product_id": "{{ product.id }}", "quantity": 1 }' hx-target="#cart-items, #cart-items-desktop">
        <span class="font-bold text-brand-400 text-lg">${{ product.price|intcomma }}</span>
        <!-- Formatted price -->
    </div>
</div>
{% empty %}
<div class="col-span-full text-center text-gray-400 py-4">
    No se encontraron productos.
</div>
{% endfor %}